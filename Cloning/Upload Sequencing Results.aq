{"config":{"title":"Upload Sequencing Results","description":"No description given","copyright":"No copyright declared","version":"no version info","authors":[],"maintainer":{"name":"No maintainer","email":"noone@nowehere"},"acknowledgements":[],"github":{"repo":"none","user":"none","access_token":"none"},"keywords":[],"aquadoc_version":"1.0.0"},"components":[{"sample_types":[{"id":2,"name":"Plasmid","description":"A circular piece of double stranded DNA","created_at":"2013-10-15T09:59:25.000-07:00","updated_at":"2015-11-29T07:55:20.000-08:00","field_types":[{"id":4,"parent_id":2,"name":"Sequence","ftype":"url","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:30:08.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":5,"parent_id":2,"name":"Sequence Verification","ftype":"url","choices":null,"array":false,"required":false,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:16:33.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":6,"parent_id":2,"name":"Bacterial Marker 1","ftype":"string","choices":"Amp, Cam, Carb, Kan, Spec, Strep, Other, N/A","array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2020-03-05T14:47:09.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":7,"parent_id":2,"name":"Yeast Marker","ftype":"string","choices":"HIS, TRP, URA, LEU, NatMX, KanMX, HygMX, BleoMX ,5FOA, N/A, Other","array":false,"required":false,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2017-07-24T14:23:40.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":8,"parent_id":2,"name":"Length","ftype":"number","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:16:33.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":42,"parent_id":2,"name":"Sequencing Primers","ftype":"sample","choices":null,"array":true,"required":false,"created_at":"2016-05-09T21:30:48.000-07:00","updated_at":"2016-05-09T21:30:48.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[{"id":26,"field_type_id":42,"sample_type_id":1,"object_type_id":null,"created_at":"2016-05-09T21:30:48.000-07:00","updated_at":"2016-05-09T21:30:48.000-07:00","sample_type":{"id":1,"name":"Primer","description":"The primer stock solutions are diluted to 25 uM. Primer melting temperatures should be calculated using the **NEB Tm calculator http://tmcalculator.neb.com/#!/main configured for Phusion High-Fidelity DNA Polymerase (HF Buffer)** for standard PCR reaction","created_at":"2013-10-08T10:18:01.000-07:00","updated_at":"2018-02-25T04:40:37.000-08:00"}}],"sample_types":["Primer"],"object_types":[null]},{"id":2246,"parent_id":2,"name":"Alias","ftype":"string","choices":"Promoter, CDS, Terminator, Backbone, RBS, Marker, Insulator, Reporter Plasmid, Gate, Circuit w/ Reporter Plasmid, Other, N/A","array":false,"required":false,"created_at":"2017-08-28T09:14:15.000-07:00","updated_at":"2020-03-05T14:51:23.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":10458,"parent_id":2,"name":"Bacterial Marker 2","ftype":"string","choices":"Amp, Cam, Carb, Kan, Spec, Strep, Other, N/A","array":false,"required":true,"created_at":"2020-03-05T14:47:09.000-08:00","updated_at":"2020-03-05T14:47:57.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]}]},{"id":1,"name":"Primer","description":"The primer stock solutions are diluted to 25 uM. Primer melting temperatures should be calculated using the **NEB Tm calculator http://tmcalculator.neb.com/#!/main configured for Phusion High-Fidelity DNA Polymerase (HF Buffer)** for standard PCR reaction","created_at":"2013-10-08T10:18:01.000-07:00","updated_at":"2018-02-25T04:40:37.000-08:00","field_types":[{"id":1,"parent_id":1,"name":"Overhang Sequence","ftype":"string","choices":null,"array":false,"required":false,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:25:11.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":2,"parent_id":1,"name":"Anneal Sequence","ftype":"string","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:25:11.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":3,"parent_id":1,"name":"T Anneal","ftype":"number","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:25:11.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":2207,"parent_id":1,"name":"URL","ftype":"url","choices":null,"array":false,"required":false,"created_at":"2017-07-24T14:21:24.000-07:00","updated_at":"2017-07-24T14:21:24.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]}]}],"object_types":[{"id":571,"name":"Plasmid Stock","description":"A plasmid stock that has yet to be sequenced verified","min":0,"max":1,"handler":"sample_container","safety":"No safety information","cleanup":"No cleanup information","data":"{ \"min_conc\": 0.000000005, \"rec_conc\": 0.000000025, \"max_vol\": 1500, \"conc_callback\": \"nanodrop_dsdna\", \"short_description\":\"1.5 mL tube\", \"opentrons_labware\": \"24-well-1.5ml-rack\"}","vendor":"No vendor information","created_at":"2017-03-31T15:34:41.000-07:00","updated_at":"2018-09-19T18:46:08.000-07:00","unit":"Plasmid","cost":0.01,"release_method":"return","release_description":"","sample_type_id":2,"image":"","prefix":"M20P","rows":null,"columns":null,"sample_type_name":"Plasmid"}],"operation_type":{"name":"Upload Sequencing Results","category":"Cloning","deployed":false,"on_the_fly":false,"field_types":[{"ftype":"sample","role":"input","name":"Plasmid","sample_types":["Plasmid"],"object_types":["Plasmid Stock"],"part":false,"array":false,"routing":"P","preferred_operation_type_id":491,"preferred_field_type_id":5720,"choices":null},{"ftype":"sample","role":"output","name":"Plasmid","sample_types":["Plasmid"],"object_types":["Plasmid Stock"],"part":false,"array":false,"routing":"P","preferred_operation_type_id":null,"preferred_field_type_id":null,"choices":null}],"protocol":"needs \"Standard Libs/Debug Lib\"\nneeds \"Cloning Libs/Cloning\"\n\nclass Protocol\n  include Debug\n  include Cloning\n  ORDER = \"Plasmid\"\n\n  def main\n\n    # debuggin'\n    if debug\n      operations.first.set_input_data ORDER, :tracking_num, 12345\n    end\n    \n    operations.retrieve interactive: false\n\n    tracking_num = operations.first.input_data(ORDER, :tracking_num)\n    \n    results_info = show do\n      title \"Check if Sequencing results arrived?\"\n      \n      check \"Go to the \u003ca href='http://www.quintarabio.com/' target='_blank'\u003eQUINTARA website\u003c/a\u003e, log in with lab account (Username: damplab@bu.edu, Password: cidar01).\"\n      check \"In 'Sanger Sequencing' tab, find the Reference ID #{tracking_num}, and check if the sequencing results have shown up yet.\"\n      \n      select [\"Yes\", \"No\"], var: \"results_back_or_not\", label: \"Do the sequencing results show up?\"\n    end\n\n    raise \"The sequencing results have not shown up yet.\" if results_info[:results_back_or_not] == \"No\"\n\n    show do\n      title \"Download Quintara Sequencing Results zip file\"\n      check \"Click the tab 'ab1', which should download a zip file named #{tracking_num}.zip.\"\n      check \"Save the zip file in 'Sequencing Results' folder, on Desktop.\"\n      #check \"Upload the #{tracking_num}_ab1.zip file here.\"\n      #check \"Wait until the download is complete.\"\n    end\n    \n    sequencing_uploads = show do\n      title \"Upload individual sequencing results\"\n      check \"Unzip the downloaded zip file named #{tracking_num}_ab1.zip.\"\n      check \"If you are on a Windows machine, open the #{tracking_num}.zip file, then click Extract.\"\n      check \"Upload all the unzipped ab1 files by navigating to the upzipped folder.\"\n      check \"You can use Shift command to select all files.\"\n      check \"Wait until all the uploads finished (a number appears at the end of file name). \"\n      \n      upload var: \"sequencing_results\"\n    end\n\n    operations.each do |op|\n      op.pass(\"Plasmid\",\"Plasmid\")\n      # find sequencing result for op\n      upload_results = sequencing_uploads[:sequencing_results] || []\n      sequencing_upload_id = upload_results.find { |result| result[:name].include? op.input(ORDER).item.id.to_s }\n      if sequencing_upload_id\n        upload = Upload.find(sequencing_upload_id[:id])\n        op.output(\"Plasmid\").item.associate (:sequencing_results, \"Please click \\\"Seq OK\\\" or discard the item after reviewing sequencing data.\", upload)\n      end\n      \n      #pass through plasmid \n    end\n    \n    ops_by_user = {}\n    operations.each do |op|\n        user = User.find(op.user_id)\n        if ops_by_user.keys.include? user\n            ops_by_user[user] \u003c\u003c op\n        else\n            ops_by_user[user] = [op]\n        end\n    end\n    \n    ops_by_user.each do |user, ops|\n        body = \"\n        Hello #{user.name},\u003cbr/\u003e\u003cbr/\u003e\n        DAMP Lab North has received sequencing results for the following items. Please follow the links provided to view your items in the inventory. To accept sequencing results and continue with downstream operations, click the green \\\"Seq OK\\\" button when viewing an item in your inventory. If a sequence is incorrect, discard the item. For questions or additional information, email #{Parameter.get_string('smtp_email_address')}.\u003cbr/\u003e\u003cbr/\u003e\n        #{\n            ops.map { |op|\n                \"\u003cb\u003eItem:\u003c/b\u003e #{op.input(\"Plasmid\").item.id.to_s} \u003cb\u003eSample:\u003c/b\u003e #{op.input(\"Plasmid\").sample.name} \u003cb\u003ePlan:\u003c/b\u003e #{op.plan.id}. \u003ca href=\\\"http://54.190.2.203/browser?sid=#{op.input(\"Plasmid\").sample.id.to_s}\\\"\u003eView in inventory\u003c/a\u003e\"}.join(\"\u003cbr/\u003e\")\n        }\"\n        if user.parameters.find { |p| p.key == 'email'}\n            send_email user.name, user.parameters.find { |p| p.key == 'email'}.value, \"DAMP Lab Seqeuncing Results\", body\n        end\n    end\n\n    return {}\n    \n  end\n\nend\n","precondition":"def precondition(op)\n  true\nend","cost_model":"# All related numbers come from 'Damp Lab Services_Dec2019'\n# materials are calculated on 'Damp Lab Services_Dec2019'\n# l stands for labor\n\ndef cost(op)\n    l = 24.88 * Parameter.get_float('labor rate (min)')\n    {labor: 0, materials: l }\nend","documentation":"This is run after \u003cb\u003eSend to Sequencing\u003c/b\u003e and is a precursor to \u003cb\u003eConfirm Sequencing Results\u003c/b\u003e. Sequencing results will be associated with plasmid stock items, and the user will be notified by email that results have arrived.\u003cbr\u003e\u003cbr\u003e\n\n\u003cb\u003eImportant notes on user confirmation of sequencing results:\u003c/b\u003e\u003cbr\u003e\n    -\"Send to Sequencing\" should always be followed by \"Upload Sequencing Results\"\u003cbr\u003e\n    -If \"Confirm Sequencing Results\" is added after \"Upload Sequencing Results\", anything downstream of \"Confirm Sequencing Results\" will wait for the user to confirm or reject the sequencing results before continuing.\u003cbr\u003e\n    -When sequencing results arrive, you will receive an email with instructions on how to view and confirm/reject your results.\u003cbr\u003e","test":"","timing":null}}]}