{"config":{"title":"Run On Agarose Gel","description":"No description given","copyright":"No copyright declared","version":"no version info","authors":[],"maintainer":{"name":"No maintainer","email":"noone@nowehere"},"acknowledgements":[],"github":{"repo":"none","user":"none","access_token":"none"},"keywords":[],"aquadoc_version":"1.0.0"},"components":[{"sample_types":[{"id":4,"name":"Fragment","description":"A linear double stranded piece of DNA from PCR or Restriction Digest","created_at":"2013-10-16T14:33:41.000-07:00","updated_at":"2015-11-29T07:55:20.000-08:00","field_types":[{"id":11,"parent_id":4,"name":"Sequence","ftype":"url","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2018-02-16T23:49:44.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":12,"parent_id":4,"name":"Length","ftype":"number","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:17:39.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":13,"parent_id":4,"name":"Template","ftype":"sample","choices":null,"array":false,"required":false,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-12T19:07:59.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[{"id":2,"field_type_id":13,"sample_type_id":2,"object_type_id":null,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T20:40:31.000-07:00","sample_type":{"id":2,"name":"Plasmid","description":"A circular piece of double stranded DNA","created_at":"2013-10-15T09:59:25.000-07:00","updated_at":"2015-11-29T07:55:20.000-08:00"}},{"id":3,"field_type_id":13,"sample_type_id":3,"object_type_id":null,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T20:40:31.000-07:00","sample_type":{"id":3,"name":"E. coli strain","description":"A strain of E. coli distinguished from others by genomic (not plasmid) modifications.","created_at":"2013-10-15T10:16:52.000-07:00","updated_at":"2017-07-24T14:24:50.000-07:00"}},{"id":4,"field_type_id":13,"sample_type_id":4,"object_type_id":null,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T20:40:31.000-07:00","sample_type":{"id":4,"name":"Fragment","description":"A linear double stranded piece of DNA from PCR or Restriction Digest","created_at":"2013-10-16T14:33:41.000-07:00","updated_at":"2015-11-29T07:55:20.000-08:00"}}],"sample_types":["Plasmid","E. coli strain","Fragment"],"object_types":[null,null,null]},{"id":14,"parent_id":4,"name":"Forward Primer","ftype":"sample","choices":null,"array":false,"required":false,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-12T19:07:59.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[{"id":6,"field_type_id":14,"sample_type_id":1,"object_type_id":null,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T20:40:31.000-07:00","sample_type":{"id":1,"name":"Primer","description":"The primer stock solutions are diluted to 25 uM. Primer melting temperatures should be calculated using the **NEB Tm calculator http://tmcalculator.neb.com/#!/main configured for Phusion High-Fidelity DNA Polymerase (HF Buffer)** for standard PCR reaction","created_at":"2013-10-08T10:18:01.000-07:00","updated_at":"2018-02-25T04:40:37.000-08:00"}}],"sample_types":["Primer"],"object_types":[null]},{"id":15,"parent_id":4,"name":"Reverse Primer","ftype":"sample","choices":null,"array":false,"required":false,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-12T19:07:59.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[{"id":7,"field_type_id":15,"sample_type_id":1,"object_type_id":null,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T20:40:31.000-07:00","sample_type":{"id":1,"name":"Primer","description":"The primer stock solutions are diluted to 25 uM. Primer melting temperatures should be calculated using the **NEB Tm calculator http://tmcalculator.neb.com/#!/main configured for Phusion High-Fidelity DNA Polymerase (HF Buffer)** for standard PCR reaction","created_at":"2013-10-08T10:18:01.000-07:00","updated_at":"2018-02-25T04:40:37.000-08:00"}}],"sample_types":["Primer"],"object_types":[null]},{"id":6036,"parent_id":4,"name":"Raw Sequence","ftype":"string","choices":null,"array":false,"required":false,"created_at":"2018-02-16T23:48:20.000-08:00","updated_at":"2018-02-16T23:48:20.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]}]},{"id":2,"name":"Plasmid","description":"A circular piece of double stranded DNA","created_at":"2013-10-15T09:59:25.000-07:00","updated_at":"2015-11-29T07:55:20.000-08:00","field_types":[{"id":4,"parent_id":2,"name":"Sequence","ftype":"url","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:30:08.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":5,"parent_id":2,"name":"Sequence Verification","ftype":"url","choices":null,"array":false,"required":false,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:16:33.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":6,"parent_id":2,"name":"Bacterial Marker 1","ftype":"string","choices":"Amp, Cam, Carb, Kan, Spec, Strep, Other, N/A","array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2020-03-05T14:47:09.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":7,"parent_id":2,"name":"Yeast Marker","ftype":"string","choices":"HIS, TRP, URA, LEU, NatMX, KanMX, HygMX, BleoMX ,5FOA, N/A, Other","array":false,"required":false,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2017-07-24T14:23:40.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":8,"parent_id":2,"name":"Length","ftype":"number","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:16:33.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":42,"parent_id":2,"name":"Sequencing Primers","ftype":"sample","choices":null,"array":true,"required":false,"created_at":"2016-05-09T21:30:48.000-07:00","updated_at":"2016-05-09T21:30:48.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[{"id":26,"field_type_id":42,"sample_type_id":1,"object_type_id":null,"created_at":"2016-05-09T21:30:48.000-07:00","updated_at":"2016-05-09T21:30:48.000-07:00","sample_type":{"id":1,"name":"Primer","description":"The primer stock solutions are diluted to 25 uM. Primer melting temperatures should be calculated using the **NEB Tm calculator http://tmcalculator.neb.com/#!/main configured for Phusion High-Fidelity DNA Polymerase (HF Buffer)** for standard PCR reaction","created_at":"2013-10-08T10:18:01.000-07:00","updated_at":"2018-02-25T04:40:37.000-08:00"}}],"sample_types":["Primer"],"object_types":[null]},{"id":2246,"parent_id":2,"name":"Alias","ftype":"string","choices":"Promoter, CDS, Terminator, Backbone, RBS, Marker, Insulator, Reporter Plasmid, Gate, Circuit w/ Reporter Plasmid, Other, N/A","array":false,"required":false,"created_at":"2017-08-28T09:14:15.000-07:00","updated_at":"2020-03-05T14:51:23.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":10458,"parent_id":2,"name":"Bacterial Marker 2","ftype":"string","choices":"Amp, Cam, Carb, Kan, Spec, Strep, Other, N/A","array":false,"required":true,"created_at":"2020-03-05T14:47:09.000-08:00","updated_at":"2020-03-05T14:47:57.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]}]},{"id":1,"name":"Primer","description":"The primer stock solutions are diluted to 25 uM. Primer melting temperatures should be calculated using the **NEB Tm calculator http://tmcalculator.neb.com/#!/main configured for Phusion High-Fidelity DNA Polymerase (HF Buffer)** for standard PCR reaction","created_at":"2013-10-08T10:18:01.000-07:00","updated_at":"2018-02-25T04:40:37.000-08:00","field_types":[{"id":1,"parent_id":1,"name":"Overhang Sequence","ftype":"string","choices":null,"array":false,"required":false,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:25:11.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":2,"parent_id":1,"name":"Anneal Sequence","ftype":"string","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:25:11.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":3,"parent_id":1,"name":"T Anneal","ftype":"number","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T21:25:11.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":2207,"parent_id":1,"name":"URL","ftype":"url","choices":null,"array":false,"required":false,"created_at":"2017-07-24T14:21:24.000-07:00","updated_at":"2017-07-24T14:21:24.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]}]},{"id":3,"name":"E. coli strain","description":"A strain of E. coli distinguished from others by genomic (not plasmid) modifications.","created_at":"2013-10-15T10:16:52.000-07:00","updated_at":"2017-07-24T14:24:50.000-07:00","field_types":[{"id":10,"parent_id":3,"name":"Parent","ftype":"sample","choices":null,"array":false,"required":true,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2017-07-24T14:24:50.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[{"id":1,"field_type_id":10,"sample_type_id":3,"object_type_id":null,"created_at":"2016-05-09T20:40:31.000-07:00","updated_at":"2016-05-09T20:40:31.000-07:00","sample_type":{"id":3,"name":"E. coli strain","description":"A strain of E. coli distinguished from others by genomic (not plasmid) modifications.","created_at":"2013-10-15T10:16:52.000-07:00","updated_at":"2017-07-24T14:24:50.000-07:00"}}],"sample_types":["E. coli strain"],"object_types":[null]}]},{"id":40,"name":"Digested DNA","description":"Temporary samples containing a digested piece of double stranded DNA.","created_at":"2018-01-31T15:55:23.000-08:00","updated_at":"2018-01-31T15:55:23.000-08:00","field_types":[{"id":2710,"parent_id":40,"name":"Input DNA","ftype":"sample","choices":null,"array":false,"required":true,"created_at":"2018-01-31T15:55:23.000-08:00","updated_at":"2018-03-02T07:42:32.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[{"id":2527,"field_type_id":2710,"sample_type_id":2,"object_type_id":null,"created_at":"2018-01-31T15:55:23.000-08:00","updated_at":"2018-01-31T16:21:28.000-08:00","sample_type":{"id":2,"name":"Plasmid","description":"A circular piece of double stranded DNA","created_at":"2013-10-15T09:59:25.000-07:00","updated_at":"2015-11-29T07:55:20.000-08:00"}},{"id":2532,"field_type_id":2710,"sample_type_id":4,"object_type_id":null,"created_at":"2018-01-31T16:21:28.000-08:00","updated_at":"2018-01-31T16:21:28.000-08:00","sample_type":{"id":4,"name":"Fragment","description":"A linear double stranded piece of DNA from PCR or Restriction Digest","created_at":"2013-10-16T14:33:41.000-07:00","updated_at":"2015-11-29T07:55:20.000-08:00"}}],"sample_types":["Plasmid","Fragment"],"object_types":[null,null]},{"id":2713,"parent_id":40,"name":"Restriction Enzyme 1","ftype":"sample","choices":"EcoRI, SpeI, XbaI, SacI","array":false,"required":true,"created_at":"2018-01-31T15:55:23.000-08:00","updated_at":"2018-02-01T12:33:34.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[{"id":2533,"field_type_id":2713,"sample_type_id":6,"object_type_id":null,"created_at":"2018-01-31T16:21:28.000-08:00","updated_at":"2018-01-31T16:21:28.000-08:00","sample_type":{"id":6,"name":"Enzyme","description":"Enzymes in 1.5 mL tubes stored at -20C","created_at":"2013-12-31T10:23:07.000-08:00","updated_at":"2015-12-08T17:39:25.000-08:00"}}],"sample_types":["Enzyme"],"object_types":[null]},{"id":2714,"parent_id":40,"name":"Restriction Enzyme 2","ftype":"sample","choices":null,"array":false,"required":true,"created_at":"2018-01-31T15:55:23.000-08:00","updated_at":"2018-02-01T12:33:34.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[{"id":2529,"field_type_id":2714,"sample_type_id":6,"object_type_id":null,"created_at":"2018-01-31T15:55:23.000-08:00","updated_at":"2018-01-31T16:21:28.000-08:00","sample_type":{"id":6,"name":"Enzyme","description":"Enzymes in 1.5 mL tubes stored at -20C","created_at":"2013-12-31T10:23:07.000-08:00","updated_at":"2015-12-08T17:39:25.000-08:00"}}],"sample_types":["Enzyme"],"object_types":[null]},{"id":2759,"parent_id":40,"name":"Length","ftype":"number","choices":null,"array":false,"required":true,"created_at":"2018-02-01T12:33:34.000-08:00","updated_at":"2018-02-01T12:33:34.000-08:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]}]},{"id":6,"name":"Enzyme","description":"Enzymes in 1.5 mL tubes stored at -20C","created_at":"2013-12-31T10:23:07.000-08:00","updated_at":"2015-12-08T17:39:25.000-08:00","field_types":[{"id":2222,"parent_id":6,"name":"Vendor","ftype":"string","choices":null,"array":false,"required":false,"created_at":"2017-08-10T11:14:33.000-07:00","updated_at":"2017-08-10T11:14:33.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":2223,"parent_id":6,"name":"Vendor #","ftype":"string","choices":null,"array":false,"required":false,"created_at":"2017-08-10T11:14:33.000-07:00","updated_at":"2017-08-10T11:14:33.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]},{"id":2226,"parent_id":6,"name":"Lot #","ftype":"string","choices":null,"array":false,"required":false,"created_at":"2017-08-10T11:14:50.000-07:00","updated_at":"2017-08-10T11:14:50.000-07:00","parent_class":"SampleType","role":null,"part":null,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"allowable_field_types":[],"sample_types":[],"object_types":[]}]}],"object_types":[{"id":290,"name":"PCR Result","description":"PCR results that contain the fragment we aim to amplify out.","min":0,"max":1000,"handler":"sample_container","safety":"No safety information","cleanup":"No cleanup information","data":"{ \"max_vol\": 100, \"short_description\":\"PCR tube\"}","vendor":"No vendor information","created_at":"2014-01-10T02:39:29.000-08:00","updated_at":"2018-02-10T17:30:38.000-08:00","unit":"Fragment","cost":5.0,"release_method":"query","release_description":"Dispose if there is less than 5 ?L.","sample_type_id":4,"image":"","prefix":"M20SRX","rows":null,"columns":null,"sample_type_name":"Fragment"},{"id":642,"name":"Restriction Digest Product","description":"The impure product of a restriction digest. Should be cleaned up immediately.","min":0,"max":1000,"handler":"sample_container","safety":"No safety information","cleanup":"No cleanup information","data":"{\"max_vol\": 2000.0, \"short_description\":\"1.5 mL tube\"}","vendor":"No vendor information","created_at":"2018-01-31T16:00:26.000-08:00","updated_at":"2018-02-10T16:56:14.000-08:00","unit":"Digested DNA","cost":0.01,"release_method":"dispose","release_description":"","sample_type_id":4,"image":"","prefix":"M20SRX","rows":null,"columns":null,"sample_type_name":"Fragment"},{"id":639,"name":"Agarose Gel","description":"An agarose gel. May contain up to 100 lanes and be any percentage","min":0,"max":100,"handler":"collection","safety":"No safety information","cleanup":"No cleanup information","data":"No data","vendor":"No vendor information","created_at":"2017-12-05T14:08:23.000-08:00","updated_at":"2017-12-05T14:08:23.000-08:00","unit":"gel","cost":0.01,"release_method":"return","release_description":"Return this item.","sample_type_id":null,"image":"","prefix":"","rows":1,"columns":12,"sample_type_name":null}],"operation_type":{"name":"Run On Agarose Gel","category":"Cloning","deployed":false,"on_the_fly":false,"field_types":[{"ftype":"sample","role":"input","name":"Impure DNA","sample_types":["Fragment","Digested DNA"],"object_types":["PCR Result","Restriction Digest Product"],"part":false,"array":false,"routing":"F","preferred_operation_type_id":466,"preferred_field_type_id":2355,"choices":null},{"ftype":"sample","role":"output","name":"Gel Lane","sample_types":["Fragment","Digested DNA"],"object_types":["Agarose Gel","Agarose Gel"],"part":true,"array":false,"routing":"F","preferred_operation_type_id":null,"preferred_field_type_id":null,"choices":null}],"protocol":"needs \"Standard Libs/Debug Lib\"\nneeds \"Cloning Libs/Cloning\"\nclass Protocol\n  include Debug\n  include Cloning\n  \n  PERCENTAGE = 1.0\n  LADDER_LANES_PER_GEL = 1\n  # Define gel box types. Can be updated as new gel boxes are purchased. Only one comb configuration is currently allowed per gel box type.\n  # \"count\" designates the total number of gel boxes of this type available in this lab.\n  # Volumes should be set at 1.2x desired volume to account for evaporation during agarose preparation\n  GEL_BOX_TYPES = [\n    { count: 1, description: \"EasyCast B1A\", lanes_per_gel: 10, volume: 56.0*1.2, comb_description: \"B1A-10 (10 well comb, purple). Note that the comb is double sided and you MUST use the side with thicker teeth.\"},\n    { count: 1, description: \"EasyCast B2\", lanes_per_gel: 20, volume: 168.0*1.2, comb_description: \"B2-20 (20 well comb, green). Note that the comb is double sided and you MUST use the side with thicker teeth.\"}\n    ]\n    \n    \n  def main\n    current_taken_items = []\n    # Remember to add volume information to input and output object types (and concentration data where applicable).\n    \n    show do\n        title \"Keep all items on ice\"\n        warning \"Note: All items used in this protocol should be kept on ice (or thawed at room temperature then immediately transfered to ice).\"\n    end\n    \n    operations.add_static_inputs \"Loading Dye\", \"6X Loading Dye\", \"Screw Cap Tube Stock\"\n    operations.add_static_inputs \"Ladder\", \"2-Log DNA Ladder\", \"Ladder Stock\"\n    operations.add_static_inputs \"DpnI\", \"DpnI\", \"Enzyme Stock\"\n    operations.sort_by! {|op| op.input(\"Impure DNA\").item.id}\n    \n    gel_box_types_by_size = GEL_BOX_TYPES.sort_by { |box_type| box_type[:lanes_per_gel] }\n    gel_box_types_by_size.each_index do |index|\n        gel_box_types_by_size[index][:count_confirmed] = false\n        gel_box_types_by_size[index][:lanes_per_gel] -= LADDER_LANES_PER_GEL\n    end\n    \n    choices_confirmed = false\n    # Algorithm which decides which gel boxes to use and confirms box availability with the tech.\n    while !choices_confirmed\n        lanes_remaining = operations.running.count\n        # if there are not enough gel boxes to do this, abort\n        total_lanes_available = 0\n        gel_box_types_by_size.each do |box_type|\n            total_lanes_available += box_type[:count]*box_type[:lanes_per_gel]\n        end\n        if total_lanes_available \u003c lanes_remaining\n            show do\n                title \"Not enough gel boxes available\"\n                warning \"There are not enough gel boxes available to perform the selected operations. The protocol will now abort. Check with lab manager for next steps.\"\n            end\n            return {}\n        end\n        \n        box_counts_required = Array.new(GEL_BOX_TYPES.count, 0)\n        while lanes_remaining \u003e 0\n            # Iterate through, skipping if box_counts_required for that box type is already \u003e= count. Stop at either first box that is big enough or the last box in the list. Reduce lanes remaining by size of box and add one to count required of that box. Continue until no lanes remaining.\n            gel_box_types_by_size.each_with_index do |box_type, box_type_index|\n                largest_available = -1\n                gel_box_types_by_size.each_with_index do |elem, index|\n                    if elem[:count] \u003e box_counts_required[index]\n                        largest_available = index\n                    end\n                end\n                if box_counts_required[box_type_index] \u003c box_type[:count] \u0026\u0026 lanes_remaining \u003e 0 \u0026\u0026 (box_type[:lanes_per_gel] \u003e= lanes_remaining || box_type_index == largest_available)\n                    box_counts_required[box_type_index] += 1\n                    lanes_remaining = [0, lanes_remaining-box_type[:lanes_per_gel]].max\n                end\n            end\n        end\n        # Check with user if there are enough boxes of different types, adjusting :count for each type to reflect actual availability. Skip any that the tech has already been asked about.\n        choices_confirmed = true\n        box_counts_required.each_with_index do |count_required, box_type_index|\n            if count_required \u003e 0 \u0026\u0026 !gel_box_types_by_size[box_type_index][:count_confirmed]\n                options = Array.new(gel_box_types_by_size[box_type_index][:count]+1){|i| (i).to_s}\n                data = show do\n                    title \"Indicate number of available gel boxes\"\n                    select options, var: \"number_available\", label: \"How many gel boxes of type #{gel_box_types_by_size[box_type_index][:description]} are currently available?\", default: gel_box_types_by_size[box_type_index][:count]\n                end\n                gel_box_types_by_size[box_type_index][:count] = data[:number_available].to_i\n                gel_box_types_by_size[box_type_index][:count_confirmed] = true\n                if data[:number_available].to_i \u003c count_required\n                    choices_confirmed = false\n                end\n            end\n        end\n    end\n    box_counts_required_run = box_counts_required\n    \n    pcr_input_ops = operations.running.select{|op| op.input(\"Impure DNA\").object_type.name.include?(\"PCR\")}\n    log_info \"box_counts_required\", box_counts_required\n    log_info \"box_counts_required.sum\", box_counts_required.sum\n    log_info \"operations.running.count.to_f\", operations.running.count.to_f\n    log_info \"(10.0*box_counts_required.sum/operations.running.count.to_f).round(2)\", (10.0*box_counts_required.sum/operations.running.count.to_f).round(2)\n    input_volumes = {\"Impure DNA\" =\u003e 5.0, \"Loading Dye\" =\u003e 1.0, \"Ladder\" =\u003e (5.0*box_counts_required.sum/operations.running.count.to_f).round(2), \"DpnI\" =\u003e (pcr_input_ops.count / operations.running.count.to_f).round(2) }\n    check_user_inputs [\"Impure DNA\"], input_volumes, current_taken_items\n    assign_input_items [\"Loading Dye\", \"Ladder\", \"DpnI\"], input_volumes, current_taken_items\n    return {} if check_for_errors\n    \n    if pcr_input_ops.any?\n        robust_take_inputs [\"Impure DNA\", \"DpnI\"], current_taken_items, interactive: true\n    \n        show do\n            title \"Add DpnI to PCR input items\"\n            note \"Add DpnI to PCR input items according to the following table:\"\n            table pcr_input_ops.start_table\n            .input_item(\"Impure DNA\")\n            .custom_column(heading: \"DpnI to add\") {|op| {content: \"1 µl of #{op.input(\"DpnI\").item}\", check: true} }\n            .end_table\n        end\n        \n        pcr_input_ops.running.each do |op|\n            op.input(\"Impure DNA\").item.move(\"37C incubator\")\n            op.input(\"Impure DNA\").item.save\n        end\n    \n        robust_release_inputs [\"Impure DNA\", \"DpnI\"], current_taken_items, interactive: true\n    end\n    \n    lanes_made = 0\n    box_counts_required.each_with_index do |count_required, box_type_index|\n        volume = gel_box_types_by_size[box_type_index][:volume]\n        comb_description = gel_box_types_by_size[box_type_index][:comb_description]\n        description = gel_box_types_by_size[box_type_index][:description]\n        mass = ((PERCENTAGE / 100.0) * volume).round(2)\n        while count_required \u003e 0\n            current_gel_ops = operations.running[lanes_made..[operations.running.count - 1, lanes_made + gel_box_types_by_size[box_type_index][:lanes_per_gel] - 1].min]\n            lanes_made += [operations.running.count - lanes_made, gel_box_types_by_size[box_type_index][:lanes_per_gel]].min\n            show do\n                title \"Prepare agarose solution\"\n                check \"Grab a flask that can hold at least #{(volume*2).ceil} mL.\"\n                check \"Using a digital scale, measure out #{mass} g of agarose powder and add it to the flask.\"\n                check \"Get a graduated cylinder from the cabinet. Measure and add #{volume} mL of 1X TAE to the flask containing agarose.\"\n                check \"Microwave flask for 60 seconds on high, then swirl.\"\n                warning \"Be careful! The hot agarose solution can split when mixed.\"\n                check \"Confirm that the agarose is fully dissolved by swirling gently and visually checking for undisolved specks of agarose. If necessary, microwave 30 more seconds on high. Repeat until dissolved. Carefully watch for signs of boiling and stop when necessary to prevent boiling over.\"\n                warning \"Wear high temperature protective gloves whenever handling this flask.\"\n            end\n            \n            show do\n                #Adding double SYBR safe for brighter band.\n                title \"Add #{(volume/10.0).round(2)} µL SYBR Safe\"\n                check \"Pipette #{(volume/10.0).round(2)} µL of SYBR Safe (on shelf) directly into the molten agar (with pipette tip under the surface), then swirl to mix.\"\n            end\n            \n            show do\n                title \"Prepare gel box for casting\"\n                check \"Locate the following gel box: #{description}\"\n                check \"Retrieve the following comb: #{comb_description}\"\n                image 'gel/comb.jpg'\n                check \"Turn the casting tray sideways in the gel box such that the orange rubber gasket is pressed tightly against the sides of the gel box. Insert the comb into the grooves at one end of the casting tray.\"\n                image 'gel/setup.jpg'\n                warning \"Many combs have thick teeth on one side and thinner teeth on the other, double check that you are using the correct side\"\n            end\n            \n            show do\n                title \"Pour and label gel\"\n                check \"Using a gel pouring autoclave glove, gently pour agarose from the flask into the casting tray.\"\n                check \"Pop any bubbles with a 10 µL pipet tip.\"\n                check \"Clean the flask with H2O and put it back on shelf.\"\n                #check \"Write id #{current_gel_ops.output_collections[\"Lane\"][0].id.to_s} on piece of lab tape and affix it to the side of the gel box. You can find pen and tape on the shelf.\"\n            end\n            count_required -= 1\n        end\n    end\n    \n    show do\n        title \"Let the Agarose to Solidify\"\n        check \"Leave the gel(s) at the bench to solidify, for 1 hour.\"\n        timer initial: { hours: 1, minutes: 0, seconds: 0}\n    end\n    \n    #operations.store(io: \"output\")\n    #return {}\n    \n    ##################################################################################################\n    robust_take_inputs [\"Impure DNA\", \"Loading Dye\", \"Ladder\"], current_taken_items, interactive: true\n    \n    show do\n        title \"Add 6X loading dye to input tubes\"\n        note \"Add #{input_volumes[\"Loading Dye\"]} µl of 6X loading dye to each 5 µl input tube according to the following table.\"\n        table operations.running.start_table\n        .input_item(\"Impure DNA\")\n        .custom_column(heading: \"Loading dye to add\", checkable: true) { |op| \"#{input_volumes[\"Loading Dye\"]} µl of #{op.input(\"Loading Dye\").item.id} (#{op.input(\"Loading Dye\").sample.name})\"}\n        .end_table\n    end\n    \n    lanes_made = 0\n    box_counts_required_run.each_with_index do |count_required, box_type_index|\n        while count_required \u003e 0\n            current_gel_ops = operations[lanes_made..[operations.running.count - 1, lanes_made + gel_box_types_by_size[box_type_index][:lanes_per_gel] - 1].min]\n            current_gel_ops.extend(OperationList)\n            current_gel_ops.make\n            \n            table_matrix = Array.new(2) {Array.new(gel_box_types_by_size[box_type_index][:lanes_per_gel] + 2) {\"\"}}\n            table_matrix[0].each_index do |column|\n                if column == 0\n                    table_matrix[0][column] = \"Well in gel\"\n                else\n                    table_matrix[0][column] = column\n                end\n            end\n            table_matrix[1].each_index do |column|\n                if column == 0\n                    table_matrix[1][column] = \"Input item to load\"\n                elsif column == 1\n                    table_matrix[1][column] = {content: \"5 µl of #{current_gel_ops[0].input(\"Ladder\").item.to_s} (#{current_gel_ops[0].input(\"Ladder\").sample.name})\", check: true}\n                elsif column \u003c= current_gel_ops.count+1\n                    table_matrix[1][column] = {content: \"1 µl of Loading dye and 5 µl of #{current_gel_ops[column-2].input(\"Impure DNA\").item.to_s}\", check: true}\n                end\n            end\n            gel_id = current_gel_ops[0].output(\"Gel Lane\").collection.id.to_s\n            show do\n                title \"Prepare gel #{gel_id}\"\n                bullet \"Insert a gel of type #{gel_box_types_by_size[box_type_index][:description]} into gel box with the comb near the NEGATIVE (black) electrode.\"\n                bullet \"Remove comb from gel.\"\n                bullet \"Confirm that the gel is covered with buffer. Add more 1X TAE to the gel box if necessary.\"\n                bullet \"Label gel by placing a piece of tape on the gel box with the gel ID: #{gel_id}\"\n            end\n            show do\n                title \"Load gel #{gel_id}\"\n                note \"Add ladder and DNA samples to the gel according to the following table:\"\n                table table_matrix\n            end\n            \n            show do\n                title \"Start gel #{gel_id}\"\n                image 'gel/run.jpg'\n                bullet \"Carefully attach the gel box lid(s) to the gel box(es), being careful not to bump the samples out of the wells. Attach the red electrode to the red terminal of the power supply, and the black electrode to the neighboring black terminal. Set the voltage to 150 V.\"\n                bullet \"Hit the start button.\"\n                bullet \"Make sure the power supply is not erroring (no E* messages) and that there are bubbles emerging from the platinum wires in the bottom corners of the gel box.\"\n            end\n            lanes_made += [operations.running.count - lanes_made, gel_box_types_by_size[box_type_index][:lanes_per_gel]].min\n            count_required -= 1\n        end\n    end\n    \n    #operations.running.each {|op| op.input(\"Impure DNA\").item.mark_as_deleted}\n    \n    pcr_input_ops.running.each do |op|\n        op.input(\"Impure DNA\").item.move(\"DAMP Lab M20SRXS Box 0\")\n        op.input(\"Impure DNA\").item.save\n    end\n    \n    robust_release_inputs [\"Impure DNA\", \"Loading Dye\", \"Ladder\"], current_taken_items, interactive: true\n    \n    show do\n        title \"Set timer\"\n        check \"Set a timer for 20 minutes. When the timer goes off, find a lab manager to check if the gel is finished.\"\n        check \"If the gel is finished, turn off the power supply. Extract fragment should be run immediately.\"\n        timer initial: { hours: 0, minutes: 20, seconds: 0}\n    end\n    \n    return {}\n  end\nend","precondition":"def precondition(op)\n    true\nend","cost_model":"# Run Gel Cost Model\n\n# All related numbers come from 'Damp Lab Services_Dec2019'\n# materials are calculated on 'Damp Lab Services_Dec2019'\n# l stands for labor\n\ndef cost(op)\n    l = 5.8 * Parameter.get_float('labor rate (min)')\n    {labor: 0, materials: 6.34+l }\nend","documentation":"This is run after \u003cb\u003ePCR or Restriction Digest\u003c/b\u003e and is a precursor to \u003cb\u003eExtract Fragment\u003c/b\u003e. The technician will run the item on a 1% agarose gel. Note! \u003cb\u003eThis operation does not include aquiring an image\u003c/b\u003e; extract fragment should be run as the downstream operation.","test":"","timing":null}}]}